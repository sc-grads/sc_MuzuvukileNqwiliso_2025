name: SSIS Build and Deploy (Manual)

on:
  workflow_dispatch:  # Enables manual run via GitHub UI

permissions:
  contents: read

jobs:
  build_and_deploy:
    runs-on: windows-latest  # Use windows-latest for cloud runner; change to self-hosted if needed
    #environment: production

    steps:
    # Step 1: Checkout the repository
    - name: Checkout repository
      uses: actions/checkout@v4

    # Step 2: Set up SSIS DevOps Tools
    - name: Setup SQL Server SSIS DevOps Tools
      uses: jonlabelle/setup-ssis-devops-tools@v1

    # Step 3: Build SSIS Project
    - name: Build SSIS Packages
      run: |
        SSISBuild.exe -p:"${{ github.workspace }}\HandsOnProject\Timesheet\MigratingTimesheet\MigratingTimesheet.dtproj" -o:"${{ github.workspace }}\SSISOutput"

    # Step 4: Deploy SSIS Package to SSISDB
    - name: Deploy SSIS Packages
      run: |
        SSISDeploy.exe -s:"${{ github.workspace }}\SSISOutput\MigratingTimesheet.ispac" -d:"catalog;/SSISDB/TimesheetDeploy/MigratingTimesheet;LAPTOP-62JJ49T4" -at:SQL -u:Auto_user -p:SecurePass2025
