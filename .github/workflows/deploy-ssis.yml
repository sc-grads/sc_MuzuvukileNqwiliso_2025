name: SSIS Build and Deploy

on:
  workflow_dispatch:

jobs:
  build_and_deploy:
    runs-on: windows-latest

    steps:
    # Step 1: Checkout the repository
    - name: Checkout repository
      uses: actions/checkout@v4

    # Step 2: Verify file structure (debugging step)
    - name: List repository files
      run: |
        dir "${{ github.workspace }}\HandsOnProject\Timesheet\MigratingTimesheet" /s

    # Step 3: Set up SSIS DevOps Tools
    - name: Setup SQL Server SSIS DevOps Tools
      uses: jonlabelle/setup-ssis-devops-tools@v1

    # Step 4: Build SSIS Project
    - name: Build SSIS Packages
      run: |
        SSISBuild.exe -p:"${{ github.workspace }}\HandsOnProject\Timesheet\MigratingTimesheet\MigratingTimesheet.dtproj" -o:"${{ github.workspace }}\SSISOutput"

    # Step 5: Deploy SSIS Package to SSISDB
    - name: Deploy SSIS Packages
      run: |
        SSISDeploy.exe -s:"${{ github.workspace }}\SSISOutput\MigratingTimesheet.ispac" -d:"catalog;/SSISDB/TimesheetDeploy/MigratingTimesheet;LAPTOP-62JJ49T4" -at:SQL -u:Auto_user -p:SecurePass2025
